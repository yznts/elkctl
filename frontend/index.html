<!doctype html>
<html lang="en" dark>
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="/wails.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>elkctl</title>
        <!-- Basecoat -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.2/dist/basecoat.cdn.min.css"
        />
        <script
            src="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.2/dist/js/all.min.js"
            defer
        ></script>
        <!-- Tailwind -->
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
        <!-- Overrides -->
        <link href="/style.css" rel="stylesheet" type="text/css" />
        <script>
            document.documentElement.classList.add("dark");
        </script>
    </head>
    <body class="font-mono">
        <!-- Device list -->
        <section
            x-data="device()"
            x-init="init()"
            class="w-full p-2 flex flex-col gap-2"
        >
            <!-- Actual device list -->
            <div class="flex flex-col gap-2">
                <template x-for="device in state.devices">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="flex items-center gap-1">
                                <div
                                    x-show="device.Powered && device.Enabled"
                                    class="w-2 h-2 bg-green-400 rounded"
                                ></div>
                                <div
                                    x-show="device.Powered && !device.Enabled"
                                    class="w-2 h-2 bg-yellow-400 rounded"
                                ></div>
                                <div
                                    x-show="!device.Powered"
                                    class="w-2 h-2 bg-red-400 rounded"
                                ></div>
                                <span>ðŸ’¡</span>
                                <span
                                    x-text="device.Name"
                                    class="badge-secondary text-xs"
                                ></span>
                            </div>
                        </div>
                        <div class="flex gap-1">
                            <button
                                class="btn-sm-icon-outline"
                                x-on:click="switchEnableState(device.Name)"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke-width="1.5"
                                    stroke="currentColor"
                                    class="size-4"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z"
                                    />
                                </svg>
                            </button>
                            <button
                                class="btn-sm-icon-outline"
                                x-on:click="switchPowerState(device.Name)"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke-width="1.5"
                                    stroke="currentColor"
                                    class="size-4"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z"
                                    />
                                </svg>
                            </button>
                            <button
                                class="btn-sm-icon-destructive"
                                x-on:click="removeDevice(device.Name)"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke-width="1.5"
                                    stroke="currentColor"
                                    class="size-4"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"
                                    />
                                </svg>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
            <!-- Add new device form -->
            <details class="group">
                <summary class="w-full transition-all outline-none rounded-md">
                    <h2
                        class="flex flex-1 items-start justify-between gap-4 py-2 text-left text-sm font-medium"
                    >
                        <div
                            class="w-full flex items-center justify-center gap-1"
                        >
                            <span class="btn-sm-outline text-xs w-full">
                                + Add new device
                            </span>
                        </div>
                    </h2>
                </summary>
                <section class="card border-[var(--border)] px-4 mb-4">
                    <form id="add-device-form" class="flex flex-col gap-1">
                        <input
                            class="input text-xs"
                            type="text"
                            name="name"
                            placeholder="Device name"
                            x-model="bindings.name"
                        />
                        <input
                            class="input text-xs"
                            type="text"
                            name="addr"
                            placeholder="Device ID/MAC"
                            x-model="bindings.addr"
                        />
                        <button
                            type="button"
                            class="mt-2 btn-sm"
                            @click="addDevice()"
                        >
                            Add
                        </button>
                    </form>
                </section>
            </details>
        </section>
        <div class="bg-[var(--border)] w-full h-[1px]"></div>
        <!-- Mode -->
        <section x-data="mode()" x-init="init()" class="mt-4 px-2">
            <!-- Mode select -->
            <select
                x-model="bindings.mode"
                x-on:change="changeMode()"
                class="select text-xs w-full"
            >
                <option value="">---</option>
                <option value="static:rgb">Static RGB</option>
                <option value="track:screen">Screen tracking</option>
            </select>
            <!-- Mode configuration -->
            <div class="mt-2">
                <!-- Static RGB -->
                <div
                    x-show="bindings.mode == 'static:rgb'"
                    class="flex items-center gap-2"
                >
                    <input
                        type="color"
                        value="#333"
                        x-model="bindings.staticRgbColor"
                        x-on:input="staticRgbSetColor()"
                        class="w-[36px] h-[36px] border border-[var(--border)] rounded-sm"
                    />
                    <input
                        type="range"
                        min="0"
                        max="100"
                        value="50"
                        x-model="bindings.staticRgbBrightness"
                        x-on:input="staticRgbSetBrightness()"
                        class="input w-full"
                    />
                </div>
            </div>
        </section>

        <!-- Status bar -->
        <section
            x-data="statusbar()"
            class="absolute bottom-0 left-0 right-0 h-5 py-3 flex items-center justify-between bg-[var(--card)] border-t border-[var(--border)] text-sm"
        >
            <!-- Left -->
            <div class="px-2 flex items-center gap-2">
                <button x-on:click="quit()" class="btn-sm-icon-ghost w-6 h-6">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="size-4"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"
                        />
                    </svg>
                </button>
            </div>
            <!-- Right -->
            <div class="px-2 flex items-center gap-2 text-green-400">
                <div class="text-xs">24ms</div>
                <div class="w-2 h-2 bg-green-400 rounded"></div>
            </div>
        </section>

        <!-- Modules -->
        <script type="module" src="/module.device.js"></script>
        <script type="module" src="/module.mode.js"></script>
        <script type="module" src="/module.statusbar.js"></script>
        <!-- Alpine.js -->
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>

        <!-- Slider JS -->
        <script>
            (() => {
                const sliders = document.querySelectorAll(
                    'input[type="range"].input',
                );
                if (!sliders) return;

                const updateSlider = (el) => {
                    const min = parseFloat(el.min || 0);
                    const max = parseFloat(el.max || 100);
                    const value = parseFloat(el.value);
                    const percent =
                        max === min ? 0 : ((value - min) / (max - min)) * 100;
                    el.style.setProperty("--slider-value", `${percent}%`);
                };

                sliders.forEach((slider) => {
                    updateSlider(slider);
                    slider.addEventListener("input", (event) =>
                        updateSlider(event.target),
                    );
                });
            })();
        </script>
    </body>
</html>
